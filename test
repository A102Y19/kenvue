def wait_for_update_installer_and_information():
    logging.info("Starting OMP monitoring process...")

    omp_window = get_stable_omp_window()
    if not omp_window:
        logging.warning("OMP not detected. Will continue monitoring Information popup globally.")

    update_installer_found = False
    for attempt in range(6):
        if omp_window and not is_window_valid(omp_window):
            omp_window = get_stable_omp_window()

        if omp_window:
            try:
                panes = omp_window.descendants()
                for pane in panes:
                    name = pane.element_info.name.lower()
                    text = pane.window_text().lower()
                    if "update installer" in name or "update installer" in text:
                        logging.info("Update Installer detected")
                        update_installer_found = True
                        break
                if update_installer_found:
                    break
            except:
                logging.warning("Error scanning OMP panes")
        logging.info(f"Update Installer not found, retrying 10s (Attempt {attempt+1}/6)")
        time.sleep(10)

    logging.info("Monitoring Information popup globally every 60s...")
    while True:
        try:
            # Scan all top-level windows
            windows = Desktop(backend="uia").windows()
            for win in windows:
                title = win.window_text().lower()
                if "information" in title:
                    logging.info(f"Information popup detected: {title}")
                    pyautogui.press("enter")
                    logging.info("ENTER sent to close popup")

                    # Check for Notepad
                    notepad_found = False
                    start_time = time.time()
                    while time.time() - start_time < 60:
                        for nw in Desktop(backend="uia").windows():
                            if "notepad" in nw.window_text().lower():
                                handle_notepad_if_opened(nw)
                                notepad_found = True
                                break
                        if notepad_found:
                            break
                        time.sleep(5)
                    return
        except Exception as e:
            logging.error(f"Error scanning global windows: {e}")
        time.sleep(60)
